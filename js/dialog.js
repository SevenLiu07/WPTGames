!function(){Widget.register({type:"overlay",selector:"div.widget-overlay",styleRules:["div.widget-overlay { display: none; left: 0; top: 0; background-color: black; opacity: 0.4; filter: alpha(opacity=40); }"],methods:{reposition:function(){var i=this,t=i.context.dialogs,e=t.getLast();return e?(i.setStyle("zIndex",e.getStyle("zIndex")-1),e.focus(),i.isVisible||(i.resizeInIE6&&window.attachEvent("onresize",i.resizeInIE6),i.fade("in",{duration:500,timingFunction:"easeOut"}),i.isVisible=!0,i.resize(),i.context.on("focusin.freezeInteractionArea",function(e){var n=e.target;if(n!==i){var o=t.getLast();!o.contains(n)&&o.offsetWidth&&o.focus()}}))):i.isVisible&&(i.resizeInIE6&&window.detachEvent("onresize",i.resizeInIE6),i.fade("out",{duration:500,timingFunction:"easeIn"}),i.isVisible=!1,i.context.off("focusin.freezeInteractionArea")),i},resize:function(){if(this.isVisible){var i=this.context;if(i===document.body)if(navigator.isIE6){var t=window.getClientSize();this.setStyles({width:t.width,height:t.height}),this.elements.iframe.setStyle("height",t.height),this.elements.div.setStyle("height",t.height)}else this.setStyles({right:0,bottom:0});else this.setStyles({width:i.clientWidth,height:i.clientHeight})}return this}},initialize:function(){var i=this,t=i.context=i.getParent();i.isVisible=!1;var e=t===document.body;i.setStyles({position:e?"fixed":"absolute"}),navigator.isIE6&&(i.innerHTML='<iframe frameborder="no" scrolling="no" style="display: block; width: 100%; height: 100%; filter: alpha(opacity=0);"></iframe><div style="position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: white; filter: alpha(opacity=0);"></div>',i.elements={iframe:i.getFirstChild(),div:i.getLastChild()},e&&(i.resizeInIE6=function(){i.resize()}))}})}(),function(){Widget.register({type:"dialog",selector:"div.widget-dialog",styleRules:["div.widget-dialog { display: none; outline: none; }"],config:{pinnedTarget:"",left:NaN,right:NaN,top:NaN,bottom:NaN,animation:"none"},methods:{open:function(){var i=this;if(!i.isOpen){var t=function(){var t=i.context;i.isOpen=!0,i.setStyle("zIndex",5e5+t.dialogs.push(i)).reposition(),t.overlay.reposition(),t===document.body&&window.on("resize:throttle(100).dialog_"+i.uid,navigator.isIE6?function(){setTimeout(function(){i.reposition()},0)}:function(){i.reposition()}),i.fire("open")};"slide"===i.animation?(i.setStyle("display","block"),t()):(i.fade("in",{duration:500,timingFunction:"easeOut",onStart:t}),"slide"===i.animation&&i.setStyle("marginTop",-20).morph({marginTop:0},{duration:100,timingFunction:"easeOut"}))}return i},close:function(){var i=this;if(i.isOpen){var t=function(){var t=i.context;i.isOpen=!1,t.dialogs.pop(),t.overlay.reposition(),t===document.body&&window.off("resize:throttle(100).dialog_"+i.uid),i.fire("close")};"none"===i.animation?(i.setStyle("display","none"),t()):(i.fade("out",{duration:"none"===i.animation?0:500,timingFunction:"easeIn",onFinish:t}),"slide"===i.animation&&i.morph({marginTop:-20},{duration:100,timingFunction:"easeIn",onFinish:function(){i.setStyle("marginTop",0)}}))}return i},reposition:function(){if(this.isOpen){var i,t,e=this.getClientRect(),n=e.left,o=e.top,s=e.width,a=e.height,r={};if(this.isFixedPositioned){var l=window.getClientSize();r.left=0,r.top=0,r.width=l.width,r.height=l.height}else r=this.pinnedTarget.getClientRect();if(i=Math.round(r.left+(Number.isFinite(this.left)?this.left:Number.isFinite(this.right)?r.width-s-this.right:(r.width-s)/2)),t=Math.round(r.top+(Number.isFinite(this.top)?this.top:Number.isFinite(this.bottom)?r.height-a-this.bottom:(r.height-a)/4)),this.isFixedPositioned){var d=0,h=d+r.width,g=0,c=g+r.height;i<d&&(i=d),i+s>h&&(i=h-s),t+a>c&&(t=c-a),t<g&&(t=g)}this.setStyles({left:parseInt(this.getStyle("left"),10)+i-n,top:parseInt(this.getStyle("top"),10)+t-o}),this.fire("reposition")}return this}},initialize:function(){var i,t=this,e=t.context=t.getParent();t.pinnedTarget=t.pinnedTarget&&(i=document.$("#"+t.pinnedTarget))&&e.contains(i)&&i!==t?i:e,navigator.isIE6&&(t.animation="none"),t.isFixedPositioned=t.pinnedTarget===document.body,t.isOpen=!1,e.dialogs||(e!==document.body&&"static"===e.getStyle("position")&&e.setStyle("position","relative"),e.dialogs=[],Widget.parse(e.overlay=document.$('<div class="widget-overlay"></div>').insertTo(e))),t.tabIndex=0,navigator.isIElt8&&(t.hideFocus=!0),t.setStyles({position:t.isFixedPositioned?"fixed":"absolute",left:0,top:0}),t.on("click:relay(.close).dialog",function(i){t.close(),i.preventDefault()})}})}();